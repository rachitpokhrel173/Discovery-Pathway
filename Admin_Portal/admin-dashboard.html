<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discovery Pathway - Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- EmailJS SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
        .sidebar-mobile { transform: translateX(-100%); }
        @media (min-width: 1024px) {
            .sidebar-mobile { transform: translateX(0); }
        }
        .loading { 
            border: 3px solid #f3f3f3; 
            border-top: 3px solid #3498db; 
            border-radius: 50%; 
            width: 30px; 
            height: 30px; 
            animation: spin 1s linear infinite; 
        }
        @keyframes spin { 
            0% { transform: rotate(0deg); } 
            100% { transform: rotate(360deg); } 
        }
        .page-section { display: none; }
        .page-section.active { display: block; }
        .nav-item.active { background: #EFF6FF; color: #2563EB; }
        .pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
    </style>
</head>
<body class="bg-gray-50">

    <!-- Sidebar -->
    <aside id="sidebar" class="fixed left-0 top-0 h-screen w-64 bg-white shadow-lg z-50 transition-transform duration-300 overflow-y-auto sidebar-mobile">
        <div class="p-6 border-b">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center">
                        <i class="fas fa-graduation-cap text-white"></i>
                    </div>
                    <div>
                        <h1 class="text-lg font-bold">Discovery</h1>
                        <p class="text-xs text-gray-500">Admin Panel</p>
                    </div>
                </div>
                <button onclick="closeSidebar()" class="lg:hidden text-gray-600">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        
        <nav class="p-4">
            <a href="#" onclick="showPage('dashboard')" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg mb-2 active">
                <i class="fas fa-dashboard"></i><span>Dashboard</span>
            </a>
            <a href="#" onclick="showPage('students')" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-gray-50 text-gray-700 mb-2">
                <i class="fas fa-users"></i><span>Students</span>
            </a>
            <a href="#" onclick="showPage('tasks')" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-gray-50 text-gray-700 mb-2">
                <i class="fas fa-tasks"></i><span>Tasks</span>
            </a>
            <a href="#" onclick="showPage('appointments')" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-gray-50 text-gray-700 mb-2">
                <i class="fas fa-calendar"></i><span>Appointments</span>
            </a>
            <a href="#" onclick="showPage('classes')" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-gray-50 text-gray-700 mb-2">
                <i class="fas fa-book"></i><span>Classes</span>
            </a>
            <a href="#" onclick="showPage('settings')" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-gray-50 text-gray-700 mb-2">
                <i class="fas fa-cog"></i><span>Settings</span>
            </a>
        </nav>
    </aside>

    <!-- Main Content -->
    <div class="lg:ml-64">
        
        <!-- Top Navbar -->
        <header class="bg-white shadow-sm sticky top-0 z-40">
            <div class="px-4 lg:px-6 py-4 flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="toggleSidebar()" class="lg:hidden">
                        <i class="fas fa-bars text-gray-600"></i>
                    </button>
                    <div>
                        <p class="text-sm text-gray-500">Welcome back,</p>
                        <h2 class="font-semibold text-gray-800">Discovery Pathway</h2>
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <button onclick="loadApplicantsFromSheet()" class="p-2 rounded-full hover:bg-gray-100" title="Refresh Data">
                        <i class="fas fa-sync text-gray-600"></i>
                    </button>
                    <button class="relative p-2 rounded-full hover:bg-gray-100">
                        <i class="fas fa-bell text-gray-600"></i>
                        <span class="absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full"></span>
                    </button>
                    <div class="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center text-white font-semibold">
                        DP
                    </div>
                </div>
            </div>
        </header>

        <main class="p-4 lg:p-6">
            
            <!-- DASHBOARD PAGE -->
            <div id="dashboard-page" class="page-section active">
                <div class="flex justify-between items-center mb-6">
                    <h1 class="text-2xl font-bold text-gray-800">Dashboard Overview</h1>
                    <button onclick="loadApplicantsFromSheet()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                        <i class="fas fa-sync mr-2"></i>Refresh All Data
                    </button>
                </div>

                <!-- Stats Cards -->
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                    <div class="bg-white p-6 rounded-xl shadow-sm">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-gray-500 text-sm">Total Students</p>
                                <h3 class="text-3xl font-bold text-gray-800 mt-2" id="totalApplicants">0</h3>
                                <p class="text-green-500 text-xs mt-2">Active</p>
                            </div>
                            <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-users text-blue-600"></i>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-xl shadow-sm">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-gray-500 text-sm">Pending Tasks</p>
                                <h3 class="text-3xl font-bold text-gray-800 mt-2" id="pendingTasks">0</h3>
                                <p class="text-amber-500 text-xs mt-2">To Complete</p>
                            </div>
                            <div class="w-12 h-12 bg-amber-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-tasks text-amber-600"></i>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-xl shadow-sm">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-gray-500 text-sm">Appointments</p>
                                <h3 class="text-3xl font-bold text-gray-800 mt-2" id="totalAppointments">0</h3>
                                <p class="text-purple-500 text-xs mt-2">Scheduled</p>
                            </div>
                            <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-calendar text-purple-600"></i>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-xl shadow-sm">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-gray-500 text-sm">Active Classes</p>
                                <h3 class="text-3xl font-bold text-gray-800 mt-2" id="totalClasses">0</h3>
                                <p class="text-green-500 text-xs mt-2">Running</p>
                            </div>
                            <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-book text-green-600"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h3 class="text-lg font-semibold mb-4">Recent Students</h3>
                        <div id="recentStudents" class="space-y-3">
                            <p class="text-gray-500 text-center py-4">Loading...</p>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h3 class="text-lg font-semibold mb-4">Upcoming Appointments</h3>
                        <div id="upcomingAppointments" class="space-y-3">
                            <p class="text-gray-500 text-center py-4">No upcoming appointments</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- STUDENTS PAGE -->
            <div id="students-page" class="page-section">
                <div class="flex justify-between items-center mb-6">
                    <h1 class="text-2xl font-bold text-gray-800">Student Management</h1>
                    <div class="flex gap-3">
                        <button onclick="loadApplicantsFromSheet()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                            <i class="fas fa-sync mr-2"></i>Refresh
                        </button>
                        <button onclick="exportToCSV()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">
                            <i class="fas fa-download mr-2"></i>Export
                        </button>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-sm p-6">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-3">
                        <h3 class="text-lg font-semibold">All Students</h3>
                        <input type="text" id="searchInput" placeholder="Search students..." class="px-4 py-2 border rounded-lg" onkeyup="searchApplicants()">
                    </div>
                    
                    <div id="loadingIndicator" class="hidden flex justify-center items-center py-8">
                        <div class="loading"></div>
                        <span class="ml-3 text-gray-600">Loading...</span>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Name</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Email</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Phone</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Country</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Course</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="applicantsTableBody" class="divide-y divide-gray-200">
                                <tr>
                                    <td colspan="6" class="px-4 py-8 text-center text-gray-500">
                                        <i class="fas fa-cloud-download-alt text-4xl mb-2 text-blue-500"></i>
                                        <p class="font-semibold">Click Refresh to load students</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- TASKS PAGE -->
            <div id="tasks-page" class="page-section">
                <div class="flex justify-between items-center mb-6">
                    <h1 class="text-2xl font-bold text-gray-800">Task Management</h1>
                    <button onclick="openTaskModal()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                        <i class="fas fa-plus mr-2"></i>Assign New Task
                    </button>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="p-6 bg-yellow-50 rounded-xl border-l-4 border-yellow-500">
                        <h4 class="font-semibold text-yellow-700">To Do</h4>
                        <p class="text-3xl font-bold text-yellow-800 mt-2" id="todoCount">0</p>
                    </div>
                    <div class="p-6 bg-blue-50 rounded-xl border-l-4 border-blue-500">
                        <h4 class="font-semibold text-blue-700">In Progress</h4>
                        <p class="text-3xl font-bold text-blue-800 mt-2" id="inProgressCount">0</p>
                    </div>
                    <div class="p-6 bg-green-50 rounded-xl border-l-4 border-green-500">
                        <h4 class="font-semibold text-green-700">Completed</h4>
                        <p class="text-3xl font-bold text-green-800 mt-2" id="doneCount">0</p>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-sm p-6">
                    <h3 class="text-lg font-semibold mb-4">All Tasks</h3>
                    <div id="tasksContainer" class="space-y-3">
                        <p class="text-center text-gray-500 py-8">No tasks yet. Assign your first task!</p>
                    </div>
                </div>
            </div>

            <!-- APPOINTMENTS PAGE -->
            <div id="appointments-page" class="page-section">
                <div class="flex justify-between items-center mb-6">
                    <h1 class="text-2xl font-bold text-gray-800">Appointments</h1>
                    <button onclick="openAppointmentModal()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                        <i class="fas fa-plus mr-2"></i>New Appointment
                    </button>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-2 bg-white rounded-xl shadow-sm p-6">
                        <h3 class="text-lg font-semibold mb-4">Scheduled Appointments</h3>
                        <div id="appointmentsContainer" class="space-y-3">
                            <p class="text-center text-gray-500 py-8">No appointments scheduled</p>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h3 class="text-lg font-semibold mb-4">Quick Stats</h3>
                        <div class="space-y-4">
                            <div class="p-4 bg-blue-50 rounded-lg">
                                <p class="text-sm text-blue-600">Today</p>
                                <p class="text-2xl font-bold text-blue-700" id="todayAppointments">0</p>
                            </div>
                            <div class="p-4 bg-purple-50 rounded-lg">
                                <p class="text-sm text-purple-600">This Week</p>
                                <p class="text-2xl font-bold text-purple-700" id="weekAppointments">0</p>
                            </div>
                            <div class="p-4 bg-green-50 rounded-lg">
                                <p class="text-sm text-green-600">This Month</p>
                                <p class="text-2xl font-bold text-green-700" id="monthAppointments">0</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- CLASSES PAGE -->
            <div id="classes-page" class="page-section">
                <div class="flex justify-between items-center mb-6">
                    <h1 class="text-2xl font-bold text-gray-800">Classes Management</h1>
                    <button onclick="openClassModal()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                        <i class="fas fa-plus mr-2"></i>Add Class
                    </button>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="classesContainer">
                    <p class="text-center text-gray-500 py-8 col-span-full">No classes added yet</p>
                </div>
            </div>

            <!-- SETTINGS PAGE -->
            <div id="settings-page" class="page-section">
                <h1 class="text-2xl font-bold text-gray-800 mb-6">Settings</h1>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Email Configuration -->
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h3 class="text-lg font-semibold mb-4">
                            <i class="fas fa-envelope text-blue-600 mr-2"></i>Email Configuration
                        </h3>
                        <div class="space-y-4">
                                                        <div>
                                <label class="block text-sm font-medium mb-2">Service ID</label>
                                <input type="text" id="emailServiceId" class="w-full px-4 py-2 border rounded-lg" placeholder="This is not accessible. Please contact the developer.">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Template ID</label>
                                <input type="text" id="emailTemplateId" class="w-full px-4 py-2 border rounded-lg" placeholder="This is not accessible. Please contact the developer.">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Public Key</label>
                                <input type="text" id="emailPublicKey" class="w-full px-4 py-2 border rounded-lg" placeholder="This is not accessible. Please contact the developer.">
                            </div>
                            
                            <button onclick="saveEmailConfig()" class="w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                                <i class="fas fa-save mr-2"></i>Save Configuration
                            </button>
                            
                            <div id="emailStatusIndicator" class="p-3 bg-gray-50 border rounded-lg text-center text-sm text-gray-600">
                                <i class="fas fa-exclamation-triangle mr-2"></i>Email not configured
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h3 class="text-lg font-semibold mb-4">Google Sheets Configuration</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">Sheet ID</label>
                                <input type="text" id="settingsSheetId" class="w-full px-4 py-2 border rounded-lg" readonly value="This is not accessible. Please contact the developer.">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Sheet Name</label>
                                <input type="text" id="settingsSheetName" class="w-full px-4 py-2 border rounded-lg" readonly value="This is not accessible. Please contact the developer.">
                            </div>
                            <div class="p-4 bg-green-50 border border-green-200 rounded-lg">
                                <p class="text-sm text-green-700"><i class="fas fa-check-circle mr-2"></i>Connected to Google Sheets</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h3 class="text-lg font-semibold mb-4">System Information</h3>
                        <div class="space-y-3">
                            <div class="flex justify-between py-2 border-b">
                                <span class="text-gray-600">Version</span>
                                <span class="font-semibold">v1.1.0</span>
                            </div>
                            <div class="flex justify-between py-2 border-b">
                                <span class="text-gray-600">Students Loaded</span>
                                <span class="font-semibold" id="settingsStudentCount">0</span>
                            </div>
                            <div class="flex justify-between py-2 border-b">
                                <span class="text-gray-600">Tasks Created</span>
                                <span class="font-semibold" id="settingsTaskCount">0</span>
                            </div>
                            <div class="flex justify-between py-2">
                                <span class="text-gray-600">Last Updated</span>
                                <span class="font-semibold" id="lastUpdated">Never</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h3 class="text-lg font-semibold mb-4">Data Management</h3>
                        <div class="space-y-3">
                            <button onclick="exportAllData()" class="w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                <i class="fas fa-download mr-2"></i>Export All Data
                            </button>
                            <button onclick="clearLocalData()" class="w-full px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">
                                <i class="fas fa-trash mr-2"></i>Clear Local Data
                            </button>
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <!-- Task Modal (UPDATED WITH EMAIL FIELDS) -->
    <div id="taskModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div class="border-b px-6 py-4 flex justify-between items-center sticky top-0 bg-white">
                <h2 class="text-xl font-bold">
                    <i class="fas fa-tasks text-blue-600 mr-2"></i>Assign New Task
                </h2>
                <button onclick="closeTaskModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <form onsubmit="addTask(event)" class="p-6 space-y-4">
                <!-- Assignee Information -->
                <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                    <h3 class="font-semibold text-blue-800 mb-3">
                        <i class="fas fa-user-tag mr-2"></i>Assignee Information
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Assigned To (Name) *</label>
                            <input type="text" id="taskAssigneeName" required class="w-full px-4 py-2 border rounded-lg" placeholder="e.g., Nirmal Chaulagain">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Assignee Email *</label>
                            <input type="email" id="taskAssigneeEmail" required class="w-full px-4 py-2 border rounded-lg" placeholder="nirmal@example.com">
                        </div>
                    </div>
                    <div class="mt-3">
                        <label class="block text-sm font-medium mb-2">Assignee Position/Role</label>
                        <input type="text" id="taskAssigneeRole" class="w-full px-4 py-2 border rounded-lg" placeholder="e.g., Manager, Counselor">
                    </div>
                </div>

                <!-- Task Details -->
                <div>
                    <label class="block text-sm font-medium mb-2">Task Title *</label>
                    <input type="text" id="taskTitle" required class="w-full px-4 py-2 border rounded-lg" placeholder="e.g., Collect payment from student">
                </div>
                
                <div>
                    <label class="block text-sm font-medium mb-2">Task Description</label>
                    <textarea id="taskDescription" rows="3" class="w-full px-4 py-2 border rounded-lg" placeholder="Provide detailed instructions for this task..."></textarea>
                </div>

                <!-- Related Student (Optional) -->
                <div>
                    <label class="block text-sm font-medium mb-2">Related Student (Optional)</label>
                    <input type="text" id="taskRelatedStudent" class="w-full px-4 py-2 border rounded-lg" placeholder="Student name if task is related to specific student">
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">Priority *</label>
                        <select id="taskPriority" class="w-full px-4 py-2 border rounded-lg">
                            <option value="low">üü¢ Low</option>
                            <option value="medium" selected>üü° Medium</option>
                            <option value="high">üî¥ High</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Due Date *</label>
                        <input type="date" id="taskDueDate" required class="w-full px-4 py-2 border rounded-lg">
                    </div>
                </div>

                <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                    <label class="flex items-center space-x-2">
                        <input type="checkbox" id="sendEmailNotification" checked class="w-4 h-4">
                        <span class="text-sm font-medium text-green-800">
                            <i class="fas fa-envelope mr-1"></i>Send email notification to assignee
                        </span>
                    </label>
                </div>

                <div class="flex justify-end space-x-3 pt-4 border-t">
                    <button type="button" onclick="closeTaskModal()" class="px-6 py-2 bg-gray-100 rounded-lg hover:bg-gray-200">Cancel</button>
                    <button type="submit" id="submitTaskBtn" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                        <i class="fas fa-paper-plane mr-2"></i>Assign Task
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Appointment Modal -->
    <div id="appointmentModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md">
            <div class="border-b px-6 py-4 flex justify-between items-center">
                <h2 class="text-xl font-bold">New Appointment</h2>
                <button onclick="closeAppointmentModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <form onsubmit="addAppointment(event)" class="p-6 space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-2">Student Name *</label>
                    <input type="text" id="appointmentStudent" required class="w-full px-4 py-2 border rounded-lg">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Purpose</label>
                    <input type="text" id="appointmentPurpose" class="w-full px-4 py-2 border rounded-lg" placeholder="e.g., Consultation, Document Review">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">Date *</label>
                        <input type="date" id="appointmentDate" required class="w-full px-4 py-2 border rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Time *</label>
                        <input type="time" id="appointmentTime" required class="w-full px-4 py-2 border rounded-lg">
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Notes</label>
                    <textarea id="appointmentNotes" rows="2" class="w-full px-4 py-2 border rounded-lg"></textarea>
                </div>
                <div class="flex justify-end space-x-3 pt-4 border-t">
                    <button type="button" onclick="closeAppointmentModal()" class="px-6 py-2 bg-gray-100 rounded-lg hover:bg-gray-200">Cancel</button>
                    <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Schedule</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Class Modal -->
    <div id="classModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md">
            <div class="border-b px-6 py-4 flex justify-between items-center">
                <h2 class="text-xl font-bold">Add New Class</h2>
                <button onclick="closeClassModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <form onsubmit="addClass(event)" class="p-6 space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-2">Class Name *</label>
                    <input type="text" id="className" required class="w-full px-4 py-2 border rounded-lg" placeholder="e.g., IELTS Preparation">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Instructor</label>
                    <input type="text" id="classInstructor" class="w-full px-4 py-2 border rounded-lg">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">Schedule</label>
                        <input type="text" id="classSchedule" class="w-full px-4 py-2 border rounded-lg" placeholder="Mon, Wed, Fri">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Duration</label>
                        <input type="text" id="classDuration" class="w-full px-4 py-2 border rounded-lg" placeholder="2 hours">
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Students Enrolled</label>
                    <input type="number" id="classEnrolled" class="w-full px-4 py-2 border rounded-lg" value="0">
                </div>
                <div class="flex justify-end space-x-3 pt-4 border-t">
                    <button type="button" onclick="closeClassModal()" class="px-6 py-2 bg-gray-100 rounded-lg hover:bg-gray-200">Cancel</button>
                    <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Add Class</button>
                </div>
            </form>
        </div>
    </div>

    <script>

      function blurText() {
    document.getElementById("API_KEY").classList.add("blurred");
}

function unblurText() {
    document.getElementById("API_KEY").classList.remove("blurred");
}
        const SHEET_ID = '1WGcsbCmocmwItPC0XdaLkfb9UoN-OVYgTu1m0HglLm0';
        const API_KEY = 'AIzaSyB7fuRTNZqyb6juWEJeIzfyCb2Zh8yO6s4';
        const SHEET_NAME = 'Admission';
        
        let applicantsData = [];
        let tasksData = [];
        let appointmentsData = [];
        let classesData = [];
        let emailConfig = { serviceId: '', templateId: '', publicKey: '', configured: false };

       // Initialize EmailJS
        function initEmailJS() {
            if (emailConfig.configured && emailConfig.publicKey) {
                try {
                    emailjs.init(emailConfig.publicKey);
                    console.log('‚úÖ EmailJS initialized with key:', emailConfig.publicKey);
                    updateEmailStatus(true);
                } catch (error) {
                    console.error('‚ùå EmailJS initialization failed:', error);
                    updateEmailStatus(false);
                }
            } else {
                console.warn('‚ö†Ô∏è EmailJS not configured');
                updateEmailStatus(false);
            }
        }

        // Load data from storage
        function loadFromStorage() {
            tasksData = JSON.parse(localStorage.getItem('dpTasks') || '[]');
            appointmentsData = JSON.parse(localStorage.getItem('dpAppointments') || '[]');
            classesData = JSON.parse(localStorage.getItem('dpClasses') || '[]');
            
            // Load email config
            const savedConfig = localStorage.getItem('dpEmailConfig');
            if (savedConfig) {
                emailConfig = JSON.parse(savedConfig);
                if (emailConfig.configured) {
                    // Pre-fill the settings form
                    document.getElementById('emailServiceId').value = emailConfig.serviceId;
                    document.getElementById('emailTemplateId').value = emailConfig.templateId;
                    document.getElementById('emailPublicKey').value = emailConfig.publicKey;
                    initEmailJS();
                }
            }
        }

        // Save email configuration
        function saveEmailConfig() {
            const serviceId = document.getElementById('emailServiceId').value.trim();
            const templateId = document.getElementById('emailTemplateId').value.trim();
            const publicKey = document.getElementById('emailPublicKey').value.trim();
            
            if (!serviceId || !templateId || !publicKey) {
                showNotification('‚ö†Ô∏è Please fill all email configuration fields', 'error');
                return;
            }
            
            emailConfig = {
                serviceId: serviceId,
                templateId: templateId,
                publicKey: publicKey,
                configured: true
            };
            
            localStorage.setItem('dpEmailConfig', JSON.stringify(emailConfig));
            initEmailJS();
            showNotification('‚úÖ Email configuration saved successfully!', 'success');
        }

        // Update email status indicator
        function updateEmailStatus(isConfigured) {
            const indicator = document.getElementById('emailStatusIndicator');
            if (isConfigured) {
                indicator.className = 'p-3 bg-green-50 border border-green-200 rounded-lg text-center text-sm text-green-700';
                indicator.innerHTML = '<i class="fas fa-check-circle mr-2"></i>Email configured and ready';
            } else {
                indicator.className = 'p-3 bg-gray-50 border rounded-lg text-center text-sm text-gray-600';
                indicator.innerHTML = '<i class="fas fa-exclamation-triangle mr-2"></i>Email not configured';
            }
        }

        // Send email notification
        async function sendTaskEmail(taskData) {
            if (!emailConfig.configured) {
                console.log('Email not configured, skipping notification');
                return false;
            }

            const submitBtn = document.getElementById('submitTaskBtn');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Sending Email...';

            try {
                const templateParams = {
                    to_name: taskData.assigneeName,
                    to_email: taskData.assigneeEmail,
                    assignee_role: taskData.assigneeRole || 'Team Member',
                    task_title: taskData.title,
                    task_description: taskData.description || 'No description provided',
                    task_priority: taskData.priority.toUpperCase(),
                    task_due_date: taskData.dueDate,
                    related_student: taskData.relatedStudent || 'N/A',
                    assigned_by: 'Discovery Pathway Admin',
                    assigned_date: new Date().toLocaleDateString(),
                    company_name: 'Discovery Pathway'
                };

                await emailjs.send(
                    emailConfig.serviceId,
                    emailConfig.templateId,
                    templateParams
                );

                submitBtn.innerHTML = '<i class="fas fa-check mr-2"></i>Task Assigned!';
                return true;
            } catch (error) {
                console.error('Email send error:', error);
                submitBtn.innerHTML = '<i class="fas fa-paper-plane mr-2"></i>Assign Task';
                showNotification('‚ö†Ô∏è Task created but email failed to send', 'error');
                return false;
            } finally {
                submitBtn.disabled = false;
                setTimeout(() => {
                    submitBtn.innerHTML = '<i class="fas fa-paper-plane mr-2"></i>Assign Task';
                }, 2000);
            }
        }

        // Save data to storage
        function saveToStorage() {
            localStorage.setItem('dpTasks', JSON.stringify(tasksData));
            localStorage.setItem('dpAppointments', JSON.stringify(appointmentsData));
            localStorage.setItem('dpClasses', JSON.stringify(classesData));
        }

        // Page Navigation
        function showPage(pageName) {
            document.querySelectorAll('.page-section').forEach(section => {
                section.classList.remove('active');
            });
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            document.getElementById(pageName + '-page').classList.add('active');
            event.target.closest('.nav-item').classList.add('active');
            closeSidebar();
        }

        // Google Sheets Functions
        async function loadApplicantsFromSheet() {
            const loadingIndicator = document.getElementById('loadingIndicator');
            const tableBody = document.getElementById('applicantsTableBody');
            
            if (loadingIndicator) loadingIndicator.classList.remove('hidden');
            
            try {
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${SHEET_NAME}?key=${API_KEY}`;
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.error) throw new Error(data.error.message);
                
                if (data.values && data.values.length > 1) {
                    applicantsData = data.values.slice(1).map(row => ({
                        timestamp: row[0] || '',
                        name: row[1] || '',
                        email: row[2] || '',
                        dob: row[3] || '',
                        gender: row[4] || '',
                        address: row[5] || '',
                        qualification: row[6] || '',
                        gpa: row[7] || '',
                        university: row[8] || '',
                        phone: row[9] || '',
                        parentPhone: row[10] || '',
                        course: row[11] || '',
                        country: row[12] || '',
                        ielts: row[13] || '',
                        pte: row[14] || '',
                        japanTest: row[15] || '',
                        paymentMethod: row[16] || '',
                        paidTo: row[17] || '',
                        qrReceipt: row[18] || ''
                    }));
                    
                    displayApplicants(applicantsData);
                    updateAllStats();
                    updateRecentStudents();
                    document.getElementById('lastUpdated').textContent = new Date().toLocaleString();
                    showNotification(`‚úÖ Loaded ${applicantsData.length} students!`, 'success');
                } else {
                    if (tableBody) tableBody.innerHTML = '<tr><td colspan="6" class="px-4 py-8 text-center text-gray-500">No data found</td></tr>';
                }
            } catch (error) {
                console.error('Error:', error);
                if (tableBody) tableBody.innerHTML = `<tr><td colspan="6" class="px-4 py-8 text-center text-red-600">Error: ${error.message}</td></tr>`;
                showNotification('‚ùå Error loading data', 'error');
            } finally {
                if (loadingIndicator) loadingIndicator.classList.add('hidden');
            }
        }

        function displayApplicants(data) {
            const tableBody = document.getElementById('applicantsTableBody');
            if (!tableBody) return;
            
            if (data.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="6" class="px-4 py-8 text-center text-gray-500">No students found</td></tr>';
                return;
            }
            
            tableBody.innerHTML = data.map((a, i) => `
                <tr class="hover:bg-gray-50">
                    <td class="px-4 py-3 text-sm font-medium">${a.name}</td>
                    <td class="px-4 py-3 text-sm">${a.email}</td>
                    <td class="px-4 py-3 text-sm">${a.phone}</td>
                    <td class="px-4 py-3 text-sm">${a.country}</td>
                    <td class="px-4 py-3 text-sm">${a.course}</td>
                    <td class="px-4 py-3 text-sm">
                        <button onclick="viewApplicant(${i})" class="text-blue-600 hover:text-blue-800 mr-2">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function searchApplicants() {
            const term = document.getElementById('searchInput').value.toLowerCase();
            const filtered = applicantsData.filter(a => 
                a.name.toLowerCase().includes(term) ||
                a.email.toLowerCase().includes(term) ||
                a.phone.includes(term) ||
                a.country.toLowerCase().includes(term) ||
                a.course.toLowerCase().includes(term)
            );
            displayApplicants(filtered);
        }

        function viewApplicant(index) {
            const a = applicantsData[index];
            alert(`üë§ ${a.name}\nüìß ${a.email}\nüì± ${a.phone}\nüåç ${a.country}\nüìñ ${a.course}\nüéÇ ${a.dob}\n‚öß ${a.gender}`);
        }

        function exportToCSV() {
            if (applicantsData.length === 0) {
                showNotification('No data to export', 'info');
                return;
            }
            const csv = [
                ['Timestamp', 'Name', 'Email', 'DOB', 'Gender', 'Phone', 'Country', 'Course'],
                ...applicantsData.map(a => [a.timestamp, a.name, a.email, a.dob, a.gender, a.phone, a.country, a.course])
            ].map(row => row.join(',')).join('\n');
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `students-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            showNotification('CSV exported!', 'success');
        }

        // Task Functions
        async function addTask(event) {
            event.preventDefault();
            
            const taskData = {
                id: Date.now(),
                assigneeName: document.getElementById('taskAssigneeName').value,
                assigneeEmail: document.getElementById('taskAssigneeEmail').value,
                assigneeRole: document.getElementById('taskAssigneeRole').value,
                title: document.getElementById('taskTitle').value,
                description: document.getElementById('taskDescription').value,
                relatedStudent: document.getElementById('taskRelatedStudent').value,
                priority: document.getElementById('taskPriority').value,
                dueDate: document.getElementById('taskDueDate').value,
                status: 'todo',
                createdAt: new Date().toISOString()
            };
            
            tasksData.push(taskData);
            saveToStorage();
            displayTasks();
            updateAllStats();
            
            // Send email if checkbox is checked
            const sendEmail = document.getElementById('sendEmailNotification').checked;
            if (sendEmail && emailConfig.configured) {
                const emailSent = await sendTaskEmail(taskData);
                if (emailSent) {
                    showNotification(`‚úÖ Task assigned and email sent to ${taskData.assigneeName}!`, 'success');
                }
            } else if (sendEmail && !emailConfig.configured) {
                showNotification('‚ö†Ô∏è Task created but email not configured', 'error');
            } else {
                showNotification('‚úÖ Task assigned successfully!', 'success');
            }
            
            closeTaskModal();
            event.target.reset();
        }

        function displayTasks() {
            const container = document.getElementById('tasksContainer');
            if (!container) return;
            
            if (tasksData.length === 0) {
                container.innerHTML = '<p class="text-center text-gray-500 py-8">No tasks yet. Assign your first task!</p>';
                return;
            }
            
            container.innerHTML = tasksData.map(task => {
                const priorityColors = {
                    low: 'bg-green-100 text-green-800',
                    medium: 'bg-yellow-100 text-yellow-800',
                    high: 'bg-red-100 text-red-800'
                };
                const statusColors = {
                    todo: 'bg-gray-100 text-gray-800',
                    inprogress: 'bg-blue-100 text-blue-800',
                    done: 'bg-green-100 text-green-800'
                };
                
                return `
                    <div class="p-4 bg-gray-50 rounded-lg border hover:shadow-md transition-shadow">
                        <div class="flex justify-between items-start mb-3">
                            <div class="flex-1">
                                <h4 class="font-semibold text-lg">${task.title}</h4>
                                <p class="text-sm text-gray-600 mt-1">${task.description || 'No description'}</p>
                            </div>
                        </div>
                        
                        <div class="bg-white p-3 rounded border mb-3">
                            <p class="text-sm"><strong><i class="fas fa-user text-blue-600 mr-1"></i>Assigned to:</strong> ${task.assigneeName}</p>
                            <p class="text-sm text-gray-600"><i class="fas fa-envelope text-gray-400 mr-1"></i>${task.assigneeEmail}</p>
                            ${task.assigneeRole ? `<p class="text-sm text-gray-600"><i class="fas fa-briefcase text-gray-400 mr-1"></i>${task.assigneeRole}</p>` : ''}
                            ${task.relatedStudent ? `<p class="text-sm text-gray-600"><i class="fas fa-graduation-cap text-gray-400 mr-1"></i>Student: ${task.relatedStudent}</p>` : ''}
                        </div>
                        
                        <div class="flex flex-wrap gap-2 mb-3">
                            <span class="px-3 py-1 rounded-full text-xs font-medium ${priorityColors[task.priority]}">${task.priority.toUpperCase()}</span>
                            <span class="px-3 py-1 rounded-full text-xs font-medium ${statusColors[task.status]}">${task.status.replace('inprogress', 'IN PROGRESS').toUpperCase()}</span>
                            ${task.dueDate ? `<span class="px-3 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800"><i class="fas fa-calendar mr-1"></i>${task.dueDate}</span>` : ''}
                        </div>
                        
                        <div class="flex gap-2 justify-end">
                            <select onchange="updateTaskStatus(${task.id}, this.value)" class="px-3 py-1 border rounded text-sm">
                                <option value="todo" ${task.status === 'todo' ? 'selected' : ''}>To Do</option>
                                <option value="inprogress" ${task.status === 'inprogress' ? 'selected' : ''}>In Progress</option>
                                <option value="done" ${task.status === 'done' ? 'selected' : ''}>Done</option>
                            </select>
                            <button onclick="deleteTask(${task.id})" class="px-3 py-1 bg-red-100 text-red-600 rounded text-sm hover:bg-red-200">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateTaskStatus(taskId, newStatus) {
            const task = tasksData.find(t => t.id === taskId);
            if (task) {
                task.status = newStatus;
                saveToStorage();
                displayTasks();
                updateAllStats();
                showNotification('Task updated!', 'success');
            }
        }

        function deleteTask(taskId) {
            if (confirm('Delete this task?')) {
                tasksData = tasksData.filter(t => t.id !== taskId);
                saveToStorage();
                displayTasks();
                updateAllStats();
                showNotification('Task deleted!', 'success');
            }
        }

        // Appointment Functions
        function addAppointment(event) {
            event.preventDefault();
            appointmentsData.push({
                id: Date.now(),
                student: document.getElementById('appointmentStudent').value,
                purpose: document.getElementById('appointmentPurpose').value,
                date: document.getElementById('appointmentDate').value,
                time: document.getElementById('appointmentTime').value,
                notes: document.getElementById('appointmentNotes').value,
                createdAt: new Date().toISOString()
            });
            saveToStorage();
            displayAppointments();
            updateAllStats();
            closeAppointmentModal();
            event.target.reset();
            showNotification('Appointment scheduled!', 'success');
        }

        function displayAppointments() {
            const container = document.getElementById('appointmentsContainer');
            if (!container) return;
            
            if (appointmentsData.length === 0) {
                container.innerHTML = '<p class="text-center text-gray-500 py-8">No appointments scheduled</p>';
                return;
            }
            
            container.innerHTML = appointmentsData.map(apt => `
                <div class="p-4 bg-gray-50 rounded-lg border">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <h4 class="font-semibold">${apt.student}</h4>
                            <p class="text-sm text-gray-600">${apt.purpose || 'General consultation'}</p>
                            <div class="flex gap-3 mt-2 text-sm">
                                <span><i class="fas fa-calendar text-blue-600 mr-1"></i>${apt.date}</span>
                                <span><i class="fas fa-clock text-purple-600 mr-1"></i>${apt.time}</span>
                            </div>
                        </div>
                        <button onclick="deleteAppointment(${apt.id})" class="text-red-600 hover:text-red-800">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
            
            updateUpcomingAppointments();
        }

        function deleteAppointment(aptId) {
            if (confirm('Delete this appointment?')) {
                appointmentsData = appointmentsData.filter(a => a.id !== aptId);
                saveToStorage();
                displayAppointments();
                updateAllStats();
                showNotification('Appointment deleted!', 'success');
            }
        }

        // Class Functions
        function addClass(event) {
            event.preventDefault();
            classesData.push({
                id: Date.now(),
                name: document.getElementById('className').value,
                instructor: document.getElementById('classInstructor').value,
                schedule: document.getElementById('classSchedule').value,
                duration: document.getElementById('classDuration').value,
                enrolled: parseInt(document.getElementById('classEnrolled').value) || 0
            });
            saveToStorage();
            displayClasses();
            updateAllStats();
            closeClassModal();
            event.target.reset();
            showNotification('Class added!', 'success');
        }

        function displayClasses() {
            const container = document.getElementById('classesContainer');
            if (!container) return;
            
            if (classesData.length === 0) {
                container.innerHTML = '<p class="text-center text-gray-500 py-8 col-span-full">No classes added yet</p>';
                return;
            }
            
            container.innerHTML = classesData.map(cls => `
                <div class="bg-white rounded-xl shadow-sm p-6">
                    <div class="flex justify-between items-start mb-4">
                        <h4 class="font-semibold text-lg">${cls.name}</h4>
                        <button onclick="deleteClass(${cls.id})" class="text-red-600 hover:text-red-800">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    <div class="space-y-2 text-sm">
                        <p><i class="fas fa-user text-blue-600 mr-2"></i>${cls.instructor || 'TBA'}</p>
                        <p><i class="fas fa-calendar text-purple-600 mr-2"></i>${cls.schedule || 'Not set'}</p>
                        <p><i class="fas fa-clock text-green-600 mr-2"></i>${cls.duration || 'TBA'}</p>
                        <p><i class="fas fa-users text-amber-600 mr-2"></i>${cls.enrolled} students</p>
                    </div>
                </div>
            `).join('');
        }

        function deleteClass(classId) {
            if (confirm('Delete this class?')) {
                classesData = classesData.filter(c => c.id !== classId);
                saveToStorage();
                displayClasses();
                updateAllStats();
                showNotification('Class deleted!', 'success');
            }
        }

        // Update All Stats
        function updateAllStats() {
            document.getElementById('totalApplicants').textContent = applicantsData.length;
            document.getElementById('settingsStudentCount').textContent = applicantsData.length;
            document.getElementById('settingsTaskCount').textContent = tasksData.length;
            
            const todo = tasksData.filter(t => t.status === 'todo').length;
            const inprogress = tasksData.filter(t => t.status === 'inprogress').length;
            const done = tasksData.filter(t => t.status === 'done').length;
            
            document.getElementById('todoCount').textContent = todo;
            document.getElementById('inProgressCount').textContent = inprogress;
            document.getElementById('doneCount').textContent = done;
            document.getElementById('pendingTasks').textContent = todo + inprogress;
            
            document.getElementById('totalAppointments').textContent = appointmentsData.length;
            document.getElementById('totalClasses').textContent = classesData.length;
            
            updateAppointmentStats();
        }

        function updateAppointmentStats() {
            const today = new Date().toISOString().split('T')[0];
            const todayApts = appointmentsData.filter(a => a.date === today).length;
            document.getElementById('todayAppointments').textContent = todayApts;
            
            const weekFromNow = new Date();
            weekFromNow.setDate(weekFromNow.getDate() + 7);
            const weekApts = appointmentsData.filter(a => {
                const aptDate = new Date(a.date);
                return aptDate >= new Date() && aptDate <= weekFromNow;
            }).length;
            document.getElementById('weekAppointments').textContent = weekApts;
            
            const monthApts = appointmentsData.filter(a => {
                const aptDate = new Date(a.date);
                return aptDate.getMonth() === new Date().getMonth();
            }).length;
            document.getElementById('monthAppointments').textContent = monthApts;
        }

        function updateRecentStudents() {
            const container = document.getElementById('recentStudents');
            if (!container) return;
            
            const recent = applicantsData.slice(0, 5);
            if (recent.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-4">No students yet</p>';
                return;
            }
            
            container.innerHTML = recent.map(s => `
                <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
                    <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center">
                        <i class="fas fa-user text-blue-600"></i>
                    </div>
                    <div class="flex-1">
                        <p class="font-semibold text-sm">${s.name}</p>
                        <p class="text-xs text-gray-600">${s.course}</p>
                    </div>
                </div>
            `).join('');
        }

        function updateUpcomingAppointments() {
            const container = document.getElementById('upcomingAppointments');
            if (!container) return;
            
            const upcoming = appointmentsData.filter(a => new Date(a.date) >= new Date()).slice(0, 5);
            if (upcoming.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-4">No upcoming appointments</p>';
                return;
            }
            
            container.innerHTML = upcoming.map(apt => `
                <div class="p-3 bg-gray-50 rounded-lg">
                    <p class="font-semibold text-sm">${apt.student}</p>
                    <p class="text-xs text-gray-600 mt-1">${apt.date} at ${apt.time}</p>
                </div>
            `).join('');
        }

        // Settings Functions
        function exportAllData() {
            const data = {
                students: applicantsData,
                tasks: tasksData,
                appointments: appointmentsData,
                classes: classesData,
                exportDate: new Date().toISOString()
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `discovery-pathway-backup-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            showNotification('All data exported!', 'success');
        }

        function clearLocalData() {
            if (confirm('This will clear all tasks, appointments, and classes. Students data from Google Sheets will not be affected. Continue?')) {
                localStorage.removeItem('dpTasks');
                localStorage.removeItem('dpAppointments');
                localStorage.removeItem('dpClasses');
                tasksData = [];
                appointmentsData = [];
                classesData = [];
                displayTasks();
                displayAppointments();
                displayClasses();
                updateAllStats();
                showNotification('Local data cleared!', 'info');
            }
        }

        // Modal Functions
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('sidebar-mobile');
        }

        function closeSidebar() {
            if (window.innerWidth < 1024) {
                document.getElementById('sidebar').classList.add('sidebar-mobile');
            }
        }

        function openTaskModal() {
            document.getElementById('taskModal').classList.remove('hidden');
            // Set minimum date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('taskDueDate').setAttribute('min', today);
        }

        function closeTaskModal() {
            document.getElementById('taskModal').classList.add('hidden');
        }

        function openAppointmentModal() {
            document.getElementById('appointmentModal').classList.remove('hidden');
            // Set minimum date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('appointmentDate').setAttribute('min', today);
        }

        function closeAppointmentModal() {
            document.getElementById('appointmentModal').classList.add('hidden');
        }

        function openClassModal() {
            document.getElementById('classModal').classList.remove('hidden');
        }

        function closeClassModal() {
            document.getElementById('classModal').classList.add('hidden');
        }

        function showNotification(message, type) {
            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                info: 'bg-blue-500'
            };
            const notif = document.createElement('div');
            notif.className = `fixed top-4 right-4 ${colors[type]} text-white px-6 py-3 rounded-lg shadow-lg z-50 animate-slide-in`;
            notif.innerHTML = `<i class="fas fa-${type === 'success' ? 'check' : 'info'}-circle mr-2"></i>${message}`;
            document.body.appendChild(notif);
            setTimeout(() => {
                notif.style.opacity = '0';
                notif.style.transition = 'opacity 0.3s';
                setTimeout(() => notif.remove(), 300);
            }, 3000);
        }

        // Initialize
        window.addEventListener('load', () => {
            loadFromStorage();
            displayTasks();
            displayAppointments();
            displayClasses();
            updateAllStats();
            loadApplicantsFromSheet();
        });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeTaskModal();
                closeAppointmentModal();
                closeClassModal();
            }
        });

        // Handle window resize for sidebar
        window.addEventListener('resize', () => {
            if (window.innerWidth >= 1024) {
                document.getElementById('sidebar').classList.remove('sidebar-mobile');
            }
        });
    </script>

</body>
</html>